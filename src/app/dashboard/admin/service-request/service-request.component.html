@if(isLoading){
<div class="loading-overlay">
  <p-progress-spinner
    strokeWidth="3"
    fill="transparent"
    animationDuration=".5s"
    [style]="{ width: '50px', height: '50px' }"
  />
</div>
}

<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="service-request">
  <div class="title-header">
    <h2>Service Requests</h2>
    <p class="subtitle">
      <span>Manage Service Requests and Assign to employee in one click</span>
    </p>
  </div>

  @if(requests().length > 0) {
  <p-table
    [value]="requests()"
    class="request-table"
    responsiveLayout="scroll"
    [sortMode]="'multiple'"
  >
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="room_num">
          Room <p-sortIcon field="room_num"></p-sortIcon>
        </th>
        <th>Type</th>
        <th>Details</th>
        <th pSortableColumn="status">
          Status <p-sortIcon field="status"></p-sortIcon>
        </th>
        <th pSortableColumn="is_assigned">
          Assignment 
        </th>
        <th>Actions</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-request>
      <tr>
        <td>{{ request.room_num }}</td>
        <td>{{ request.type }}</td>
        <td class="details-cell">{{ request.details }}</td>
        <td>
          <span
            [ngClass]="{
              'status-badge': true,
              'status-assigned': request.status === 'Assigned',
              'status-pending': request.status === 'Pending',
              'status-inprogress': request.status === 'In Progress',
              'status-completed': request.status === 'Done'
            }"
          >
            {{ request.status }}
          </span>
        </td>
        <td class="assignment-cell">
          <span class="assignment-badge">
            {{ request.is_assigned ? "Assigned" : "Unassigned" }}
          </span>
        </td>
        <td class="actions">
          <p-dropdown
            [options]="staffOptions"
            [(ngModel)]="request.EmployeeID"
            placeholder="Assign"
            (onChange)="assignRequest(request)"
            [disabled]="request.is_assigned === true"
            appendTo="body"
            class="assign-dropdown"
          >
          </p-dropdown>
        </td>
      </tr>
    </ng-template>
  </p-table>
  } @else {
    <div class="no-requests-fallback">
      <i class="material-icons">assignment</i>
      <h3>No Service Requests</h3>
      <p>All service requests have been completed or there are no pending requests to manage.</p>
    </div>
  }
</div>

@if(isLoading){
<div class="loading-overlay">
  <p-progress-spinner
    strokeWidth="3"
    fill="transparent"
    animationDuration=".5s"
    [style]="{ width: '50px', height: '50px' }"
  />
</div>
}

<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="service-request">
  <div class="title-header">
    <h2>Service Requests</h2>
    <p class="subtitle">
      <span>Manage Service Requests and Assign to employee in one click</span>
    </p>
  </div>

  <p-table
    [value]="requests()"
    class="request-table"
    responsiveLayout="scroll"
    [sortMode]="'multiple'"
  >
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="room_num">
          Room <p-sortIcon field="room_num"></p-sortIcon>
        </th>
        <th>
          Type 
        </th>
        <th>
          Details
        </th>
        <th pSortableColumn="status">
          Status <p-sortIcon field="status"></p-sortIcon>
        </th>
        <th pSortableColumn="is_assigned">
          Assignment <p-sortIcon field="is_assigned"></p-sortIcon>
        </th>
        <th pSortableColumn="created_at">
          Created <p-sortIcon field="created_at"></p-sortIcon>
        </th>
        <th>Actions</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-request>
      <tr>
        <td>{{ request.room_num }}</td>
        <td>{{ request.type }}</td>
        <td>{{ request.details }}</td>
        <td>
          <span
            [ngClass]="{
              'status-assigned': request.status === 'Assigned',
              'status-pending': request.status === 'Pending',
              'status-inprogress': request.status === 'In Progress',
              'status-completed': request.status === 'Done'
            }"
          >
            {{ request.status }}
          </span>
        </td>
        <td>{{ request.is_assigned ? "Assigned" : "Unassigned" }}</td>
        <td>{{ request.created_at | date : "medium" }}</td>
        <td class="actions">
          <p-dropdown
            [options]="staffOptions"
            [(ngModel)]="request.EmployeeID"
            placeholder="Assign"
            (onChange)="assignRequest(request)"
            [disabled]="request.is_assigned === true"
            appendTo="body"
            class="assign-dropdown"
          >
          </p-dropdown>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
